<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Config - Chainlink Testing Framework</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Chainlink Testing Framework</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="toml-config"><a class="header" href="#toml-config">TOML Config</a></h1>
<div class="warning">
<p>This documentation is deprecated, we are using it in <a href="https://github.com/smartcontractkit/chainlink/tree/develop/integration-tests">Chainlink Integration Tests</a></p>
<p>If you want to test our new products use <a href="../framework/overview.html">v2</a></p>
</div>
<p>These basic building blocks can be used to create a TOML config file. For example:</p>
<pre><code class="language-golang">import (
    ctf_config "github.com/smartcontractkit/chainlink-testing-framework/config"
	ctf_test_env "github.com/smartcontractkit/chainlink-testing-framework/docker/test_env"
)

type TestConfig struct {
	ChainlinkImage         *ctf_config.ChainlinkImageConfig `toml:"ChainlinkImage"`
	ChainlinkUpgradeImage  *ctf_config.ChainlinkImageConfig `toml:"ChainlinkUpgradeImage"`
	Logging                *ctf_config.LoggingConfig        `toml:"Logging"`
	Network                *ctf_config.NetworkConfig        `toml:"Network"`
	Pyroscope              *ctf_config.PyroscopeConfig      `toml:"Pyroscope"`
	PrivateEthereumNetwork *ctf_test_env.EthereumNetwork    `toml:"PrivateEthereumNetwork"`
}
</code></pre>
<p>It's up to the user to provide a way to read the config from file and unmarshal it into the struct. You can check <a href="https://github.com/smartcontractkit/chainlink-testing-framework/blob/main/lib/config/examples/testconfig.go">testconfig.go</a> to see one way it could be done.</p>
<p><code>Validate()</code> should be used to ensure that the config is valid. Some of the building blocks have also a <code>Default()</code> method that can be used to get default values.</p>
<p>Also, you might find <code>BytesToAnyTomlStruct(logger zerolog.Logger, filename, configurationName string, target any, content []byte) error</code> utility method useful for unmarshalling TOMLs read from env var or files into a struct</p>
<h2 id="test-secrets"><a class="header" href="#test-secrets">Test Secrets</a></h2>
<p>Test secrets are not stored directly within the <code>TestConfig</code> TOML due to security reasons. Instead, they are passed into <code>TestConfig</code> via environment variables. Below is a list of all available secrets. Set only the secrets required for your specific tests, like so: <code>E2E_TEST_CHAINLINK_IMAGE=qa_ecr_image_url</code>.</p>
<h3 id="default-secret-loading"><a class="header" href="#default-secret-loading">Default Secret Loading</a></h3>
<p>By default, secrets are loaded from the <code>~/.testsecrets</code> dotenv file. Example of a local <code>~/.testsecrets</code> file:</p>
<pre><code class="language-bash">E2E_TEST_CHAINLINK_IMAGE=qa_ecr_image_url
E2E_TEST_CHAINLINK_UPGRADE_IMAGE=qa_ecr_image_url
E2E_TEST_ARBITRUM_SEPOLIA_WALLET_KEY=wallet_key
</code></pre>
<h3 id="all-e2e-test-secrets"><a class="header" href="#all-e2e-test-secrets">All E2E Test Secrets</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Secret</th><th>Env Var</th><th>Example</th></tr></thead><tbody>
<tr><td>Chainlink Image</td><td><code>E2E_TEST_CHAINLINK_IMAGE</code></td><td><code>E2E_TEST_CHAINLINK_IMAGE=qa_ecr_image_url</code></td></tr>
<tr><td>Chainlink Upgrade Image</td><td><code>E2E_TEST_CHAINLINK_UPGRADE_IMAGE</code></td><td><code>E2E_TEST_CHAINLINK_UPGRADE_IMAGE=qa_ecr_image_url</code></td></tr>
<tr><td>Wallet Key per network</td><td><code>E2E_TEST_(.+)_WALLET_KEY</code> or <code>E2E_TEST_(.+)_WALLET_KEY_(\d+)$</code></td><td><code>E2E_TEST_ARBITRUM_SEPOLIA_WALLET_KEY=wallet_key</code> or <code>E2E_TEST_ARBITRUM_SEPOLIA_WALLET_KEY_1=wallet_key_1</code>, <code>E2E_TEST_ARBITRUM_SEPOLIA_WALLET_KEY_2=wallet_key_2</code> for multiple keys per network</td></tr>
<tr><td>RPC HTTP URL per network</td><td><code>E2E_TEST_(.+)_RPC_HTTP_URL</code> or <code>E2E_TEST_(.+)_RPC_HTTP_URL_(\d+)$</code></td><td><code>E2E_TEST_ARBITRUM_SEPOLIA_RPC_HTTP_URL=url</code> or <code>E2E_TEST_ARBITRUM_SEPOLIA_RPC_HTTP_URL_1=url</code>, <code>E2E_TEST_ARBITRUM_SEPOLIA_RPC_HTTP_URL_2=url</code> for multiple http urls per network</td></tr>
<tr><td>RPC WebSocket URL per network</td><td><code>E2E_TEST_(.+)_RPC_WS_URL</code> or <code>E2E_TEST_(.+)_RPC_WS_URL_(\d+)$</code></td><td><code>E2E_TEST_ARBITRUM_RPC_WS_URL=ws_url</code> or <code>E2E_TEST_ARBITRUM_RPC_WS_URL_1=ws_url_1</code>, <code>E2E_TEST_ARBITRUM_RPC_WS_URL_2=ws_url_2</code> for multiple ws urls per network</td></tr>
<tr><td>Loki Tenant ID</td><td><code>E2E_TEST_LOKI_TENANT_ID</code></td><td><code>E2E_TEST_LOKI_TENANT_ID=tenant_id</code></td></tr>
<tr><td>Loki Endpoint</td><td><code>E2E_TEST_LOKI_ENDPOINT</code></td><td><code>E2E_TEST_LOKI_ENDPOINT=url</code></td></tr>
<tr><td>Loki Basic Auth</td><td><code>E2E_TEST_LOKI_BASIC_AUTH</code></td><td><code>E2E_TEST_LOKI_BASIC_AUTH=token</code></td></tr>
<tr><td>Loki Bearer Token</td><td><code>E2E_TEST_LOKI_BEARER_TOKEN</code></td><td><code>E2E_TEST_LOKI_BEARER_TOKEN=token</code></td></tr>
<tr><td>Grafana Bearer Token</td><td><code>E2E_TEST_GRAFANA_BEARER_TOKEN</code></td><td><code>E2E_TEST_GRAFANA_BEARER_TOKEN=token</code></td></tr>
<tr><td>Pyroscope Server URL</td><td><code>E2E_TEST_PYROSCOPE_SERVER_URL</code></td><td><code>E2E_TEST_PYROSCOPE_SERVER_URL=url</code></td></tr>
<tr><td>Pyroscope Key</td><td><code>E2E_TEST_PYROSCOPE_KEY</code></td><td><code>E2E_TEST_PYROSCOPE_KEY=key</code></td></tr>
</tbody></table>
</div>
<h3 id="run-github-workflow-with-your-test-secrets"><a class="header" href="#run-github-workflow-with-your-test-secrets">Run GitHub Workflow with Your Test Secrets</a></h3>
<p>By default, GitHub workflows execute with a set of predefined secrets. However, you can use custom secrets by specifying a unique identifier for your secrets when running the <code>gh workflow</code> command.</p>
<h4 id="steps-to-use-custom-secrets"><a class="header" href="#steps-to-use-custom-secrets">Steps to Use Custom Secrets</a></h4>
<ol>
<li>
<p><strong>Upload Local Secrets to GitHub Secrets Vault:</strong></p>
<ul>
<li>
<p><strong>Install <code>ghsecrets</code> tool:</strong>
Install the <code>ghsecrets</code> tool to manage GitHub Secrets more efficiently.</p>
<pre><code class="language-bash">go install github.com/smartcontractkit/chainlink-testing-framework/tools/ghsecrets@latest
</code></pre>
<p>If you use <code>asdf</code>, run <code>asdf reshim</code></p>
</li>
<li>
<p><strong>Upload Secrets:</strong>
Run <code>ghsecrets set</code> from local core repo to upload the content of your <code>~/.testsecrets</code> file to the GitHub Secrets Vault and generate a unique identifier (referred to as <code>your_ghsecret_id</code>).</p>
</li>
</ul>
<pre><code class="language-bash">cd path-to-chainlink-core-repo
</code></pre>
<pre><code class="language-bash">ghsecrets set
</code></pre>
<p>For more details about <code>ghsecrets</code>, visit https://github.com/smartcontractkit/chainlink-testing-framework/tree/main/tools/ghsecrets#faq</p>
</li>
<li>
<p><strong>Execute the Workflow with Custom Secrets:</strong></p>
<ul>
<li>To use the custom secrets in your GitHub Actions workflow, pass the <code>-f test_secrets_override_key={your_ghsecret_id}</code> flag when running the <code>gh workflow</code> command.
<pre><code class="language-bash">gh workflow run &lt;workflow_name&gt; -f test_secrets_override_key={your_ghsecret_id}
</code></pre>
</li>
</ul>
</li>
</ol>
<h4 id="default-secrets-handling"><a class="header" href="#default-secrets-handling">Default Secrets Handling</a></h4>
<p>If the <code>test_secrets_override_key</code> is not provided, the workflow will default to using the secrets preconfigured in the CI environment.</p>
<h3 id="creating-new-test-secrets-in-testconfig"><a class="header" href="#creating-new-test-secrets-in-testconfig">Creating New Test Secrets in TestConfig</a></h3>
<p>When adding a new secret to the <code>TestConfig</code>, such as a token or other sensitive information, the method <code>ReadConfigValuesFromEnvVars()</code> in <code>config/testconfig.go</code> must be extended to include the new secret. Ensure that the new environment variable starts with the <code>E2E_TEST_</code> prefix. This prefix is crucial for ensuring that the secret is correctly propagated to Kubernetes tests when using the Remote Runner.</p>
<p>Here’s a quick checklist for adding a new test secret:</p>
<ul>
<li>Add the secret to ~/.testsecrets with the <code>E2E_TEST_</code> prefix to ensure proper handling.</li>
<li>Extend the <code>config/testconfig.go:ReadConfigValuesFromEnvVars()</code> method to load the secret in <code>TestConfig</code></li>
<li>Add the secrets to <a href="#all-e2e-test-secrets">All E2E Test Secrets</a> table.</li>
</ul>
<h2 id="working-example"><a class="header" href="#working-example">Working example</a></h2>
<p>For a full working example making use of all the building blocks see <a href="https://github.com/smartcontractkit/chainlink-testing-framework/blob/main/lib/config/examples/testconfig.go">testconfig.go</a>. It provides methods for reading TOML, applying overrides and validating non-empty config blocks. It supports 4 levels of overrides, in order of precedence:</p>
<ul>
<li><code>BASE64_CONFIG_OVERRIDE</code> env var</li>
<li><code>overrides.toml</code></li>
<li><code>[product_name].toml</code></li>
<li><code>default.toml</code></li>
</ul>
<p>All you need to do now to get the config is execute <code>func GetConfig(configurationName string, product string) (TestConfig, error)</code>. It will first look for folder with file <code>.root_dir</code> and from there it will look for config files in all subfolders, so that you can place the config files in whatever folder(s) work for you. It assumes that all configuration versions for a single product are kept in <code>[product_name].toml</code> under different configuration names (that can represent anything you want: a single test, a test type, a test group, etc).</p>
<p>Overrides of config files are done in a super-simple way. We try to unmarshall consecutive files into the same struct. Since it's all pointer based only not-nil keys are overwritten.</p>
<h2 id="important"><a class="header" href="#important">IMPORTANT!</a></h2>
<p>It is <strong>required</strong> to add <code>overrides.toml</code> to <code>.gitignore</code> in your project, so that you don't accidentally commit it as it might contain secrets.</p>
<h2 id="network-config-and-default-rpc-endpoints"><a class="header" href="#network-config-and-default-rpc-endpoints">Network config (and default RPC endpoints)</a></h2>
<p>Some more explanation is needed for the <code>NetworkConfig</code>:</p>
<pre><code class="language-golang">type NetworkConfig struct {
	// list of networks that should be used for testing
	SelectedNetworks []string            `toml:"selected_networks"`
	// map of network name to EVMNetworks where key is network name and value is a pointer to EVMNetwork
	// if not set, it will try to find the network from defined networks in MappedNetworks under known_networks.go
	// it doesn't matter if you use `arbitrum_sepolia` or `ARBITRUM_SEPOLIA` or even `arbitrum_SEPOLIA` as key
	// as all keys will be uppercased when loading the Default config
	EVMNetworks map[string]*blockchain.EVMNetwork `toml:"EVMNetworks,omitempty"`
	// map of network name to ForkConfigs where key is network name and value is a pointer to ForkConfig
	// only used if network fork is needed, if provided, the network will be forked with the given config
	// networkname is fetched first from the EVMNetworks and
	// if not defined with EVMNetworks, it will try to find the network from defined networks in MappedNetworks under known_networks.go
    ForkConfigs map[string]*ForkConfig `toml:"ForkConfigs,omitempty"`
	// map of network name to RPC endpoints where key is network name and value is a list of RPC HTTP endpoints
	RpcHttpUrls      map[string][]string `toml:"RpcHttpUrls"`
	// map of network name to RPC endpoints where key is network name and value is a list of RPC WS endpoints
	RpcWsUrls        map[string][]string `toml:"RpcWsUrls"`
	// map of network name to wallet keys where key is network name and value is a list of private keys (aka funding keys)
	WalletKeys       map[string][]string `toml:"WalletKeys"`
}

func (n *NetworkConfig) Default() error {
    ...
}
</code></pre>
<p>Sample TOML config:</p>
<pre><code class="language-toml">selected_networks = ["arbitrum_goerli", "optimism_goerli", "new_network"]

[EVMNetworks.new_network]
evm_name = "new_test_network"
evm_chain_id = 100009
evm_simulated = true
evm_chainlink_transaction_limit = 5000
evm_minimum_confirmations = 1
evm_gas_estimation_buffer = 10000
client_implementation = "Ethereum"
evm_supports_eip1559 = true
evm_default_gas_limit = 6000000

[ForkConfigs.new_network]
url = "ws://localhost:8546"
block_number = 100

[RpcHttpUrls]
arbitrum_goerli = ["https://devnet-2.mt/ABC/rpc/"]
new_network = ["http://localhost:8545"]

[RpcWsUrls]
arbitrum_goerli = ["wss://devnet-2.mt/ABC/ws/"]
new_network = ["ws://localhost:8546"]

[WalletKeys]
arbitrum_goerli = ["1810868fc221b9f50b5b3e0186d8a5f343f892e51ce12a9e818f936ec0b651ed"]
optimism_goerli = ["1810868fc221b9f50b5b3e0186d8a5f343f892e51ce12a9e818f936ec0b651ed"]
new_network = ["ac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80"]
</code></pre>
<p>Whenever you are adding a new EVMNetwork to the config, you can either</p>
<ul>
<li>provide the rpcs and wallet keys in Rpc&lt;Http/Ws&gt;Urls and WalletKeys. Like in the example above, you can see that <code>new_network</code> is added to the <code>selected_networks</code> and <code>EVMNetworks</code> and then the rpcs and wallet keys are provided in <code>RpcHttpUrls</code>, <code>RpcWsUrls</code> and <code>WalletKeys</code> respectively.</li>
<li>provide the rpcs and wallet keys in the <code>EVMNetworks</code> itself. Like in the example below, you can see that <code>new_network</code> is added to the <code>selected_networks</code> and <code>EVMNetworks</code> and then the rpcs and wallet keys are provided in <code>EVMNetworks</code> itself.</li>
</ul>
<pre><code class="language-toml">
selected_networks = ["new_network"]

[EVMNetworks.new_network]
evm_name = "new_test_network"
evm_chain_id = 100009
evm_urls = ["ws://localhost:8546"]
evm_http_urls = ["http://localhost:8545"]
evm_keys = ["ac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80"]
evm_simulated = true
evm_chainlink_transaction_limit = 5000
evm_minimum_confirmations = 1
evm_gas_estimation_buffer = 10000
client_implementation = "Ethereum"
evm_supports_eip1559 = true
evm_default_gas_limit = 6000000
</code></pre>
<p>If your config struct looks like that:</p>
<pre><code class="language-golang">
type TestConfig struct {
	Network *ctf_config.NetworkConfig `toml:"Network"`
}
</code></pre>
<p>then your TOML file should look like that:</p>
<pre><code class="language-toml">[Network]
selected_networks = ["arbitrum_goerli","new_network"]

[Network.EVMNetworks.new_network]
evm_name = "new_test_network"
evm_chain_id = 100009
evm_simulated = true
evm_chainlink_transaction_limit = 5000
evm_minimum_confirmations = 1
evm_gas_estimation_buffer = 10000
client_implementation = "Ethereum"
evm_supports_eip1559 = true
evm_default_gas_limit = 6000000

[Network.RpcHttpUrls]
arbitrum_goerli = ["https://devnet-2.mt/ABC/rpc/"]
new_network = ["http://localhost:8545"]

[Network.RpcWsUrls]
arbitrum_goerli = ["ws://devnet-2.mt/ABC/rpc/"]
new_network = ["ws://localhost:8546"]

[Network.WalletKeys]
arbitrum_goerli = ["1810868fc221b9f50b5b3e0186d8a5f343f892e51ce12a9e818f936ec0b651ed"]
new_network = ["ac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80"]
</code></pre>
<p>If in your product config you want to support case-insensitive network names and map keys remember to run <code>NetworkConfig.UpperCaseNetworkNames()</code> on your config before using it.</p>
<h2 id="providing-custom-values-in-the-ci"><a class="header" href="#providing-custom-values-in-the-ci">Providing custom values in the CI</a></h2>
<p>Up to this point when we wanted to modify some dynamic tests parameters in the CI we would simply set env vars. That approach won't work anymore. The way to go around it is to build a TOML file, <code>base64</code> it, mask it and then set is as <code>BASE64_CONFIG_OVERRIDE</code> env var that will be read by tests. Here's an example of a working snippet of how that could look:</p>
<pre><code class="language-bash">convert_to_toml_array() {
	local IFS=','
	local input_array=($1)
	local toml_array_format="["

	for element in "${input_array[@]}"; do
		toml_array_format+="\"$element\","
	done

	toml_array_format="${toml_array_format%,}]"
	echo "$toml_array_format"
}

selected_networks=$(convert_to_toml_array "$SELECTED_NETWORKS")
log_targets=$(convert_to_toml_array "$LOGSTREAM_LOG_TARGETS")

if [ -n "$PYROSCOPE_SERVER" ]; then
	pyroscope_enabled=true
else
	pyroscope_enabled=false
fi

if [ -n "$ETH2_EL_CLIENT" ]; then
	execution_layer="$ETH2_EL_CLIENT"
else
	execution_layer="geth"
fi

if [ -n "$TEST_LOG_COLLECT" ]; then
	test_log_collect=true
else
	test_log_collect=false
fi

cat &lt;&lt; EOF &gt; config.toml
[Network]
selected_networks=$selected_networks

[ChainlinkImage]
image="$CHAINLINK_IMAGE"
version="$CHAINLINK_VERSION"

[Pyroscope]
enabled=$pyroscope_enabled
server_url="$PYROSCOPE_SERVER"
environment="$PYROSCOPE_ENVIRONMENT"
key_secret="$PYROSCOPE_KEY"

[Logging]
test_log_collect=$test_log_collect
run_id="$RUN_ID"

[Logging.LogStream]
log_targets=$log_targets

[Logging.Loki]
tenant_id="$LOKI_TENANT_ID"
url="$LOKI_URL"
basic_auth_secret="$LOKI_BASIC_AUTH"
bearer_token_secret="$LOKI_BEARER_TOKEN"

[Logging.Grafana]
url="$GRAFANA_URL"
EOF

BASE64_CONFIG_OVERRIDE=$(cat config.toml | base64 -w 0)
echo ::add-mask::$BASE64_CONFIG_OVERRIDE
echo "BASE64_CONFIG_OVERRIDE=$BASE64_CONFIG_OVERRIDE" &gt;&gt; $GITHUB_ENV
</code></pre>
<p><strong>These two lines in that very order are super important</strong></p>
<pre><code class="language-bash">BASE64_CONFIG_OVERRIDE=$(cat config.toml | base64 -w 0)
echo ::add-mask::$BASE64_CONFIG_OVERRIDE
</code></pre>
<p><code>::add-mask::</code> has to be called only after env var has been set to it's final value, otherwise it won't be recognized and masked properly and secrets will be exposed in the logs.</p>
<h2 id="providing-custom-values-for-local-execution"><a class="header" href="#providing-custom-values-for-local-execution">Providing custom values for local execution</a></h2>
<p>For local execution it's best to put custom variables in <code>overrides.toml</code> file.</p>
<h2 id="providing-custom-values-in-k8s"><a class="header" href="#providing-custom-values-in-k8s">Providing custom values in k8s</a></h2>
<p>It's easy. All you need to do is:</p>
<ul>
<li>Create TOML file with these values</li>
<li>Base64 it: <code>cat your.toml | base64</code></li>
<li>Set the base64 result as <code>BASE64_CONFIG_OVERRIDE</code> environment variable.</li>
</ul>
<p><code>BASE64_CONFIG_OVERRIDE</code> will be automatically forwarded to k8s (as long as it is set and available to the test process), when creating the environment programmatically via <code>environment.New()</code>.</p>
<p>Quick example:</p>
<pre><code class="language-bash">BASE64_CONFIG_OVERRIDE=$(cat your.toml | base64) go test your-test-that-runs-in-k8s ./file/with/your/test
</code></pre>
<h1 id="not-moved-to-toml"><a class="header" href="#not-moved-to-toml">Not moved to TOML</a></h1>
<p>Not moved to TOML:</p>
<ul>
<li><code>SLACK_API_KEY</code></li>
<li><code>SLACK_USER</code></li>
<li><code>SLACK_CHANNEL</code></li>
<li><code>TEST_LOG_LEVEL</code></li>
<li><code>CHAINLINK_ENV_USER</code></li>
<li><code>DETACH_RUNNER</code></li>
<li><code>ENV_JOB_IMAGE</code></li>
<li>most of k8s-specific env variables were left untouched</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../lib/k8s/TUTORIAL.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../lib/crib.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../lib/k8s/TUTORIAL.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../lib/crib.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
