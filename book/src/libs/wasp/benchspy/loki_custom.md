# BenchSpy - Custom Loki metrics

In this chapter we will see how to use custom LogQl queries in the performance report. For this more advanced use case
we will need to compose the performance report manually.

Load-generation part is the same as in the standard Loki metrics example and thus will be skipped.

Let's define two illustrative metrics now:
* `vu_over_time` - rate of virtual users generated by WASP, 10 seconds window
* `responses_over_time` - number of AUT's responses, 1 second window

```go
lokiQueryExecutor := benchspy.NewLokiQueryExecutor(
    map[string]string{
        "vu_over_time":        fmt.Sprintf("max_over_time({branch=~\"%s\", commit=~\"%s\", go_test_name=~\"%s\", test_data_type=~\"stats\", gen_name=~\"%s\"} | json | unwrap current_instances [10s]) by (node_id, go_test_name, gen_name)", label, label, t.Name(), gen.Cfg.GenName),
        "responses_over_time": fmt.Sprintf("sum(count_over_time({branch=~\"%s\", commit=~\"%s\", go_test_name=~\"%s\", test_data_type=~\"responses\", gen_name=~\"%s\"} [1s])) by (node_id, go_test_name, gen_name)", label, label, t.Name(), gen.Cfg.GenName),
    },
    gen.Cfg.LokiConfig,
)
```

> [!NOTE]
> These LogQl queries are using standard labels that `WASP` uses when sending data to Loki.

And create a `StandardReport` using our custom queries:
```go
baseLineReport, err := benchspy.NewStandardReport(
    "2d1fa3532656c51991c0212afce5f80d2914e34e",
    // notice the different functional option used to pass custom executors
    benchspy.WithQueryExecutors(lokiQueryExecutor),
    benchspy.WithGenerators(gen),
)
require.NoError(t, err, "failed to create baseline report")
```

The rest of the code remains basically unchanged (apart from the name of metrics we are asserting on). You can find the full example [here](...).

Now it's time to look at the last of the bundled `QueryExecutors`. Proceed to the [next chapter to read about Prometheus](./prometheus.md).