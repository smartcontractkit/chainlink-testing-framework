<!DOCTYPE HTML>
<html lang="en" class="ayu" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>CTFv1 - Chainlink Testing Framework</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('ayu')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="overview.html"><strong aria-hidden="true">1.</strong> Overview</a></li><li class="chapter-item "><a href="framework/overview.html"><strong aria-hidden="true">2.</strong> Framework</a></li><li class="chapter-item "><a href="framework/developer_environment/overview.html"><strong aria-hidden="true">3.</strong> Developer Environment</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="framework/developer_environment/toml.html"><strong aria-hidden="true">3.1.</strong> Configuration</a></li></ol></li><li class="chapter-item "><a href="framework/getting_started.html"><strong aria-hidden="true">4.</strong> Basic Usage</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="framework/getting_started.html"><strong aria-hidden="true">4.1.</strong> Getting Started</a></li></ol></li><li class="chapter-item "><a href="framework/configuration.html"><strong aria-hidden="true">5.</strong> Advanced Usage</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="framework/cli.html"><strong aria-hidden="true">5.1.</strong> CLI</a></li><li class="chapter-item "><a href="framework/configuration.html"><strong aria-hidden="true">5.2.</strong> Configuration</a></li><li class="chapter-item "><a href="framework/components/debug.html"><strong aria-hidden="true">5.3.</strong> Debugging Tests</a></li><li class="chapter-item "><a href="developing/developing_components.html"><strong aria-hidden="true">5.4.</strong> Creating your own components</a></li><li class="chapter-item "><a href="framework/components/state.html"><strong aria-hidden="true">5.5.</strong> Exposing Components</a></li><li class="chapter-item "><a href="developing/asserting_logs.html"><strong aria-hidden="true">5.6.</strong> Asserting Logs</a></li><li class="chapter-item "><a href="framework/quick_deployment.html"><strong aria-hidden="true">5.7.</strong> Quick Contracts Deployment</a></li><li class="chapter-item "><a href="framework/verify.html"><strong aria-hidden="true">5.8.</strong> Verifying Contracts</a></li><li class="chapter-item "><a href="framework/cl_node_keys_import.html"><strong aria-hidden="true">5.9.</strong> CL Node Keys Import</a></li><li class="chapter-item "><a href="framework/test_configuration_overrides.html"><strong aria-hidden="true">5.10.</strong> Test Configuration</a></li><li class="chapter-item "><a href="framework/chaos/debug-k8s.html"><strong aria-hidden="true">5.11.</strong> Debugging K8s Chaos Tests</a></li><li class="chapter-item "><a href="framework/components/cleanup.html"><strong aria-hidden="true">5.12.</strong> Components Cleanup</a></li><li class="chapter-item "><a href="framework/components/caching.html"><strong aria-hidden="true">5.13.</strong> Components Caching</a></li><li class="chapter-item "><a href="framework/components/resources.html"><strong aria-hidden="true">5.14.</strong> Components Resources</a></li><li class="chapter-item "><a href="framework/components/network_isolation.html"><strong aria-hidden="true">5.15.</strong> Containers Network Isolation</a></li><li class="chapter-item "><a href="framework/components/mocking.html"><strong aria-hidden="true">5.16.</strong> Fake Services</a></li><li class="chapter-item "><a href="framework/resource_leaks.html"><strong aria-hidden="true">5.17.</strong> Detecting Resource Leaks</a></li><li class="chapter-item "><a href="framework/copying_files.html"><strong aria-hidden="true">5.18.</strong> Copying Files</a></li><li class="chapter-item "><a href="framework/components/external.html"><strong aria-hidden="true">5.19.</strong> External Environment</a></li></ol></li><li class="chapter-item "><a href="framework/observability/observability_stack.html"><strong aria-hidden="true">6.</strong> Observability Stack</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="framework/observability/observability_stack.html"><strong aria-hidden="true">6.1.</strong> Overview</a></li><li class="chapter-item "><a href="framework/observability/metrics.html"><strong aria-hidden="true">6.2.</strong> Metrics</a></li><li class="chapter-item "><a href="framework/observability/logs.html"><strong aria-hidden="true">6.3.</strong> Logs</a></li><li class="chapter-item "><a href="framework/observability/profiling.html"><strong aria-hidden="true">6.4.</strong> Profiling</a></li><li class="chapter-item "><a href="framework/observability/postgresql.html"><strong aria-hidden="true">6.5.</strong> PostgreSQL</a></li><li class="chapter-item "><a href="framework/observability/blockscout.html"><strong aria-hidden="true">6.6.</strong> BlockScout</a></li></ol></li><li class="chapter-item "><a href="framework/components/overview.html"><strong aria-hidden="true">7.</strong> Components</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="framework/components/overview.html"><strong aria-hidden="true">7.1.</strong> Overview</a></li><li class="chapter-item "><a href="framework/components/blockchains/overview.html"><strong aria-hidden="true">7.2.</strong> Blockchains</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="framework/components/blockchains/evm.html"><strong aria-hidden="true">7.2.1.</strong> EVM</a></li><li class="chapter-item "><a href="framework/components/blockchains/solana.html"><strong aria-hidden="true">7.2.2.</strong> Solana</a></li><li class="chapter-item "><a href="framework/components/blockchains/aptos.html"><strong aria-hidden="true">7.2.3.</strong> Aptos</a></li><li class="chapter-item "><a href="framework/components/blockchains/sui.html"><strong aria-hidden="true">7.2.4.</strong> Sui</a></li><li class="chapter-item "><a href="framework/components/blockchains/tron.html"><strong aria-hidden="true">7.2.5.</strong> TRON</a></li><li class="chapter-item "><a href="framework/components/blockchains/zksync.html"><strong aria-hidden="true">7.2.6.</strong> ZKSync</a></li><li class="chapter-item "><a href="framework/components/blockchains/ton.html"><strong aria-hidden="true">7.2.7.</strong> Ton</a></li></ol></li><li class="chapter-item "><a href="framework/components/storage.html"><strong aria-hidden="true">7.3.</strong> Storage</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="framework/components/storage/s3.html"><strong aria-hidden="true">7.3.1.</strong> S3</a></li></ol></li><li class="chapter-item "><a href="framework/components/chipingresset/chip_ingress.html"><strong aria-hidden="true">7.4.</strong> Chip Ingress Set</a></li></ol></li><li class="chapter-item "><a href="framework/components/troubleshooting.html"><strong aria-hidden="true">8.</strong> Troubleshooting</a></li><li class="chapter-item "><a href="monorepo-tools.html"><strong aria-hidden="true">9.</strong> Mono Repository Tooling</a></li><li class="chapter-item "><a href="framework/testing.html"><strong aria-hidden="true">10.</strong> Testing Maturity Model</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="framework/chaos/chaos.html"><strong aria-hidden="true">10.1.</strong> Chaos Testing</a></li><li class="chapter-item "><a href="framework/fork.html"><strong aria-hidden="true">10.2.</strong> Fork Testing</a></li><li class="chapter-item "><a href="framework/fork_storage.html"><strong aria-hidden="true">10.3.</strong> Fork Testing (Mutating Storage)</a></li></ol></li><li class="chapter-item "><a href="libraries.html"><strong aria-hidden="true">11.</strong> Libraries</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="libraries.html"><strong aria-hidden="true">11.1.</strong> Overview</a></li><li class="chapter-item "><a href="libs/wasp/overview.html"><strong aria-hidden="true">11.2.</strong> WASP</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="libs/wasp/getting_started.html"><strong aria-hidden="true">11.2.1.</strong> Getting started</a></li><li class="chapter-item "><a href="libs/wasp/first_test.html"><strong aria-hidden="true">11.2.2.</strong> First test (RPS test)</a></li><li class="chapter-item "><a href="libs/wasp/stateful_test.html"><strong aria-hidden="true">11.2.3.</strong> Stateful test</a></li><li class="chapter-item "><a href="libs/wasp/user_journey_test.html"><strong aria-hidden="true">11.2.4.</strong> User Journey test</a></li><li class="chapter-item "><a href="libs/wasp/profile_test.html"><strong aria-hidden="true">11.2.5.</strong> Profile test</a></li><li class="chapter-item "><div><strong aria-hidden="true">11.2.6.</strong> Testing alerts</div></li><li class="chapter-item "><a href="libs/wasp/configuration.html"><strong aria-hidden="true">11.2.7.</strong> Configuration</a></li><li class="chapter-item "><a href="libs/wasp/k8s.html"><strong aria-hidden="true">11.2.8.</strong> k8s</a></li><li class="chapter-item "><a href="libs/wasp/components/overview.html"><strong aria-hidden="true">11.2.9.</strong> Components</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div><strong aria-hidden="true">11.2.9.1.</strong> Alert Checker</div></li><li class="chapter-item "><a href="libs/wasp/components/dashboard.html"><strong aria-hidden="true">11.2.9.2.</strong> Dashboard</a></li><li class="chapter-item "><a href="libs/wasp/components/generator.html"><strong aria-hidden="true">11.2.9.3.</strong> Generator</a></li><li class="chapter-item "><a href="libs/wasp/components/loki.html"><strong aria-hidden="true">11.2.9.4.</strong> Loki</a></li><li class="chapter-item "><a href="libs/wasp/components/profile.html"><strong aria-hidden="true">11.2.9.5.</strong> Profile</a></li><li class="chapter-item "><a href="libs/wasp/components/sampler.html"><strong aria-hidden="true">11.2.9.6.</strong> Sampler</a></li><li class="chapter-item "><a href="libs/wasp/components/schedule.html"><strong aria-hidden="true">11.2.9.7.</strong> Schedule</a></li></ol></li><li class="chapter-item "><a href="libs/wasp/benchspy/overview.html"><strong aria-hidden="true">11.2.10.</strong> BenchSpy</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="libs/wasp/benchspy/getting_started.html"><strong aria-hidden="true">11.2.10.1.</strong> Getting started</a></li><li class="chapter-item "><a href="libs/wasp/benchspy/first_test.html"><strong aria-hidden="true">11.2.10.2.</strong> Your first test</a></li><li class="chapter-item "><a href="libs/wasp/benchspy/simplest_metrics.html"><strong aria-hidden="true">11.2.10.3.</strong> Simplest metrics</a></li><li class="chapter-item "><a href="libs/wasp/benchspy/loki_std.html"><strong aria-hidden="true">11.2.10.4.</strong> Standard Loki metrics</a></li><li class="chapter-item "><a href="libs/wasp/benchspy/loki_custom.html"><strong aria-hidden="true">11.2.10.5.</strong> Custom Loki metrics</a></li><li class="chapter-item "><a href="libs/wasp/benchspy/prometheus_std.html"><strong aria-hidden="true">11.2.10.6.</strong> Standard Prometheus metrics</a></li><li class="chapter-item "><a href="libs/wasp/benchspy/prometheus_custom.html"><strong aria-hidden="true">11.2.10.7.</strong> Custom Prometheus metrics</a></li><li class="chapter-item "><a href="libs/wasp/benchspy/loki_dillema.html"><strong aria-hidden="true">11.2.10.8.</strong> To Loki or not to Loki?</a></li><li class="chapter-item "><a href="libs/wasp/benchspy/real_world.html"><strong aria-hidden="true">11.2.10.9.</strong> Real world example</a></li><li class="chapter-item "><a href="libs/wasp/benchspy/debugging.html"><strong aria-hidden="true">11.2.10.10.</strong> Debugging</a></li><li class="chapter-item "><a href="libs/wasp/benchspy/reports/overview.html"><strong aria-hidden="true">11.2.10.11.</strong> Reports</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="libs/wasp/benchspy/reports/standard_report.html"><strong aria-hidden="true">11.2.10.11.1.</strong> Standard Report</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="libs/wasp/benchspy/reports/new_executor.html"><strong aria-hidden="true">11.2.10.11.1.1.</strong> Adding new QueryExecutor</a></li><li class="chapter-item "><div><strong aria-hidden="true">11.2.10.11.1.2.</strong> Adding new standard load metric</div></li><li class="chapter-item "><div><strong aria-hidden="true">11.2.10.11.1.3.</strong> Adding new standard resource metric</div></li></ol></li><li class="chapter-item "><a href="libs/wasp/benchspy/reports/new_report.html"><strong aria-hidden="true">11.2.10.11.2.</strong> Defining a new report</a></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">11.2.10.12.</strong> Adding new storage</div></li></ol></li><li class="chapter-item "><a href="libs/wasp/how-to/overview.html"><strong aria-hidden="true">11.2.11.</strong> How to</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="libs/wasp/how-to/start_local_observability_stack.html"><strong aria-hidden="true">11.2.11.1.</strong> Start local observability stack</a></li><li class="chapter-item "><a href="libs/wasp/how-to/run_included_tests.html"><strong aria-hidden="true">11.2.11.2.</strong> Try it out quickly</a></li><li class="chapter-item "><a href="libs/wasp/how-to/chose_rps_vu.html"><strong aria-hidden="true">11.2.11.3.</strong> Chose between RPS and VUs</a></li><li class="chapter-item "><a href="libs/wasp/how-to/rps_per_minute.html"><strong aria-hidden="true">11.2.11.4.</strong> Configure requests per minute or hour</a></li><li class="chapter-item "><a href="libs/wasp/how-to/define_nfr_check_alerts.html"><strong aria-hidden="true">11.2.11.5.</strong> Define NFRs and check alerts</a></li><li class="chapter-item "><a href="libs/wasp/how-to/use_labels.html"><strong aria-hidden="true">11.2.11.6.</strong> Use labels</a></li><li class="chapter-item "><a href="libs/wasp/how-to/incorporate_load_tests.html"><strong aria-hidden="true">11.2.11.7.</strong> Incorporate load tests in your workflow</a></li><li class="chapter-item "><a href="libs/wasp/how-to/reuse_dashboard_components.html"><strong aria-hidden="true">11.2.11.8.</strong> Reuse dashboard components</a></li><li class="chapter-item "><a href="libs/wasp/how-to/parallelise_load.html"><strong aria-hidden="true">11.2.11.9.</strong> Parallelize load</a></li><li class="chapter-item "><a href="libs/wasp/how-to/debug_loki_errors.html"><strong aria-hidden="true">11.2.11.10.</strong> Debug Loki errors</a></li></ol></li><li class="chapter-item "><a href="libs/havoc.html"><strong aria-hidden="true">11.2.12.</strong> Havoc</a></li><li class="chapter-item "><a href="libs/seth.html"><strong aria-hidden="true">11.2.13.</strong> Seth</a></li></ol></li><li class="chapter-item "><a href="libs/sentinel.html"><strong aria-hidden="true">11.3.</strong> Sentinel</a></li></ol></li><li class="chapter-item "><li class="spacer"></li><li class="chapter-item expanded "><a href="legacy.html"><strong aria-hidden="true">12.</strong> Legacy</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="legacy.html"><strong aria-hidden="true">12.1.</strong> Overview</a></li><li class="chapter-item expanded "><a href="lib.html" class="active"><strong aria-hidden="true">12.2.</strong> CTFv1</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="lib/blockchain.html"><strong aria-hidden="true">12.2.1.</strong> Blockchain</a></li><li class="chapter-item "><a href="lib/concurrency.html"><strong aria-hidden="true">12.2.2.</strong> Concurrency</a></li><li class="chapter-item "><a href="lib/client.html"><strong aria-hidden="true">12.2.3.</strong> Client</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div><strong aria-hidden="true">12.2.3.1.</strong> Anvil</div></li><li class="chapter-item "><a href="lib/client/aws_secrets_manager.html"><strong aria-hidden="true">12.2.3.2.</strong> AWS Secrets Manager</a></li><li class="chapter-item "><a href="lib/client/github.html"><strong aria-hidden="true">12.2.3.3.</strong> Github</a></li><li class="chapter-item "><a href="lib/client/grafana.html"><strong aria-hidden="true">12.2.3.4.</strong> Grafana</a></li><li class="chapter-item "><a href="lib/client/kafka.html"><strong aria-hidden="true">12.2.3.5.</strong> Kafka</a></li><li class="chapter-item "><a href="lib/client/loki.html"><strong aria-hidden="true">12.2.3.6.</strong> Loki</a></li><li class="chapter-item "><a href="lib/client/mockserver.html"><strong aria-hidden="true">12.2.3.7.</strong> MockServer</a></li><li class="chapter-item "><a href="lib/client/postgres.html"><strong aria-hidden="true">12.2.3.8.</strong> Postgres</a></li><li class="chapter-item "><a href="lib/client/prometheus.html"><strong aria-hidden="true">12.2.3.9.</strong> Prometheus</a></li></ol></li><li class="chapter-item "><a href="lib/k8s_new/overview.html"><strong aria-hidden="true">12.2.4.</strong> Kubernetes</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="lib/k8s_new/environments.html"><strong aria-hidden="true">12.2.4.1.</strong> Creating environments</a></li><li class="chapter-item "><a href="lib/k8s_new/remote_runner.html"><strong aria-hidden="true">12.2.4.2.</strong> Using remote runner</a></li><li class="chapter-item "><a href="lib/k8s_new/test_secrets.html"><strong aria-hidden="true">12.2.4.3.</strong> Passing test secrets</a></li><li class="chapter-item "><a href="lib/k8s/labels.html"><strong aria-hidden="true">12.2.4.4.</strong> chain.link labels</a></li></ol></li><li class="chapter-item "><a href="lib/k8s/KUBERNETES.html"><strong aria-hidden="true">12.2.5.</strong> Kubernetes (legacy docs)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="lib/k8s/REMOTE_RUN.html"><strong aria-hidden="true">12.2.5.1.</strong> K8s Remote Run</a></li><li class="chapter-item "><a href="lib/k8s/TUTORIAL.html"><strong aria-hidden="true">12.2.5.2.</strong> K8s Tutorial</a></li></ol></li><li class="chapter-item "><a href="lib/config/config.html"><strong aria-hidden="true">12.2.6.</strong> Config</a></li><li class="chapter-item "><a href="lib/docker/overview.html"><strong aria-hidden="true">12.2.7.</strong> Docker</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="lib/docker/blockchain_nodes.html"><strong aria-hidden="true">12.2.7.1.</strong> Blockchain nodes</a></li><li class="chapter-item "><a href="lib/docker/chainlink_ecosystem.html"><strong aria-hidden="true">12.2.7.2.</strong> Chainlink ecosystem</a></li><li class="chapter-item "><div><strong aria-hidden="true">12.2.7.3.</strong> Third party apps</div></li><li class="chapter-item "><a href="lib/docker/test_helpers.html"><strong aria-hidden="true">12.2.7.4.</strong> Test helpers</a></li></ol></li><li class="chapter-item "><a href="lib/logging.html"><strong aria-hidden="true">12.2.8.</strong> Logging</a></li></ol></li><li class="chapter-item "><a href="k8s-test-runner/k8s-test-runner.html"><strong aria-hidden="true">12.3.</strong> K8s Test Runner</a></li></ol></li><li class="chapter-item "><li class="spacer"></li><li class="chapter-item "><a href="releasing_modules.html"><strong aria-hidden="true">13.</strong> Releasing modules</a></li><li class="chapter-item affix "><li class="spacer"></li><li class="chapter-item "><a href="build_info.html"><strong aria-hidden="true">14.</strong> Build info</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Chainlink Testing Framework</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<div align="center">
<h1 id="framework-v1-deprecated"><a class="header" href="#framework-v1-deprecated">Framework v1 (Deprecated)</a></h1>
<p><a href="https://github.com/smartcontractkit/chainlink-testing-framework/tags"><img src="https://img.shields.io/github/v/tag/smartcontractkit/chainlink-testing-framework?filter=%2Alib%2A" alt="Lib tag" /></a>
<a href="https://goreportcard.com/report/github.com/smartcontractkit/chainlink-testing-framework"><img src="https://goreportcard.com/badge/github.com/smartcontractkit/chainlink-testing-framework" alt="Go Report Card" /></a>
<a href="https://pkg.go.dev/github.com/smartcontractkit/chainlink-testing-framework"><img src="https://pkg.go.dev/badge/github.com/smartcontractkit/chainlink-testing-framework.svg" alt="Go Reference" /></a>
<a href="https://go.dev/"><img src="https://img.shields.io/github/go-mod/go-version/smartcontractkit/chainlink-testing-framework?filename=./lib/go.mod" alt="Go Version" /></a>
<img src="https://github.com/smartcontractkit/chainlink-testing-framework/actions/workflows/test.yaml/badge.svg" alt="Tests" />
<img src="https://github.com/smartcontractkit/chainlink-testing-framework/actions/workflows/lint.yaml/badge.svg" alt="Lint" /></p>
</div>
<div class="warning">
<p><strong>DEPRECATED: This is v1 version and it is not actively maintained</strong></p>
</div>
<p>The purpose of this framework is to:</p>
<ul>
<li>Interact with different blockchains</li>
<li>Configure CL jobs</li>
<li>Deploy using <code>docker</code></li>
<li>Deploy using <code>k8s</code></li>
</ul>
<p>If you're looking to implement a new chain integration for the testing framework, head over to the <a href="lib/blockchain.html">blockchain</a> directory for more info.</p>
<h2 id="k8s-package"><a class="header" href="#k8s-package">k8s package</a></h2>
<p>We have a k8s package we are using in tests, it provides:</p>
<ul>
<li><a href="https://cdk8s.io/">cdk8s</a> based wrappers</li>
<li>High-level k8s API</li>
<li>Automatic port forwarding</li>
</ul>
<p>You can also use this package to spin up standalone environments.</p>
<h3 id="local-k8s-cluster"><a class="header" href="#local-k8s-cluster">Local k8s cluster</a></h3>
<p>Read <a href="lib/k8s/KUBERNETES.html">here</a> about how to spin up a local cluster</p>
<h4 id="install"><a class="header" href="#install">Install</a></h4>
<p>Set up deps, you need to have <code>node 14.x.x</code>, <a href="https://helm.sh/docs/intro/install/">helm</a> and <a href="https://classic.yarnpkg.com/lang/en/docs/install/#mac-stable">yarn</a></p>
<p>Then use</p>
<pre><code class="language-shell">make install_deps
</code></pre>
<h5 id="optional-nix"><a class="header" href="#optional-nix">Optional Nix</a></h5>
<p>We have setup a nix shell which will produce a reliable environment that will behave the same locally and in ci. To use it instead of the above you will need to <a href="https://nixos.org/download/">install nix</a></p>
<p>To start the nix shell run:</p>
<pre><code class="language-shell">make nix_shell
</code></pre>
<p>If you install <a href="https://github.com/direnv/direnv/blob/master/docs/installation.md">direnv</a> you will be able to have your environment start the nix shell as soon as you cd into it once you have allowed the directory via:</p>
<pre><code class="language-shell">direnv allow
</code></pre>
<h3 id="running-tests-in-k8s"><a class="header" href="#running-tests-in-k8s">Running tests in k8s</a></h3>
<p>To read how to run a test in k8s, read <a href="lib/k8s/REMOTE_RUN.html">here</a></p>
<h3 id="usage"><a class="header" href="#usage">Usage</a></h3>
<h4 id="with-env-vars-deprecated"><a class="header" href="#with-env-vars-deprecated">With env vars (deprecated)</a></h4>
<p>Create an env in a separate file and run it</p>
<pre><code class="language-sh">export CHAINLINK_IMAGE="public.ecr.aws/chainlink/chainlink"
export CHAINLINK_TAG="1.4.0-root"
export CHAINLINK_ENV_USER="Satoshi"
go run k8s/examples/simple/env.go
</code></pre>
<p>For more features follow <a href="lib/k8s/TUTORIAL.html">tutorial</a></p>
<h4 id="with-toml-config"><a class="header" href="#with-toml-config">With TOML config</a></h4>
<p>It should be noted that using env vars for configuring CL nodes in k8s is deprecated. TOML config should be used instead:</p>
<pre><code class="language-toml">[ChainlinkImage]
image="public.ecr.aws/chainlink/chainlink"
version="v2.8.0"
</code></pre>
<p>Check the example here: <a href="https://github.com/smartcontractkit/chainlink-testing-framework/blob/main/lib/k8s/examples/simple_toml/env_toml_config.go">env.go</a></p>
<h3 id="development"><a class="header" href="#development">Development</a></h3>
<h4 id="running-standalone-example-environment"><a class="header" href="#running-standalone-example-environment">Running standalone example environment</a></h4>
<pre><code class="language-shell">go run k8s/examples/simple/env.go
</code></pre>
<p>If you have another env of that type, you can connect by overriding environment name</p>
<pre><code class="language-sh">ENV_NAMESPACE="..."  go run k8s/examples/chainlink/env.go
</code></pre>
<p>Add more presets <a href="https://github.com/smartcontractkit/chainlink-testing-framework/blob/main/lib/k8s/presets">here</a></p>
<p>Add more programmatic examples <a href="../../lib/k8s/examples/">here</a></p>
<p>If you have <a href="https://chaos-mesh.org/">chaosmesh</a> installed in your cluster you can pull and generated CRD in go like that</p>
<pre><code class="language-sh">make chaosmesh
</code></pre>
<p>If you need to check your system tests coverage, use <a href="../../lib/k8s/TUTORIAL.html#coverage">that</a></p>
<h1 id="chainlink-charts"><a class="header" href="#chainlink-charts">Chainlink Charts</a></h1>
<p>This repository contains helm charts used by the chainlink organization mostly in QA.</p>
<h2 id="chart-repository"><a class="header" href="#chart-repository">Chart Repository</a></h2>
<p>You can add the published chart repository by pointing helm to the <code>gh-pages</code> branch with a personal access token (PAT) that has at least read-only access to the repository.</p>
<pre><code class="language-sh">helm repo add chainlink-qa https://raw.githubusercontent.com/smartcontractkit/qa-charts/gh-pages/
helm search repo chainlink
</code></pre>
<h2 id="releasing-charts"><a class="header" href="#releasing-charts">Releasing Charts</a></h2>
<p>The following cases will trigger a chart release once a PR is merged into the <code>main</code> branch.
Modified packages or new packages get added and pushed to the <code>gh-pages</code> branch of the <a href="https://github.com/smartcontractkit/qa-charts">qa-charts</a> repository.</p>
<ul>
<li>An existing chart is version bumped</li>
<li>A new chart is added</li>
</ul>
<p>Removed charts do not trigger a re-publish, the packages have to be removed and the index file regenerated in the <code>gh-pages</code> branch of the <a href="https://github.com/smartcontractkit/qa-charts">qa-charts</a> repository.</p>
<p>Note: The qa-charts repository is scheduled to look for changes to the charts once every hour. This can be expedited by going to that repo and running the cd action via github UI.</p>
<h1 id="simulated-evm-chains"><a class="header" href="#simulated-evm-chains">Simulated EVM chains</a></h1>
<p>We have extended support for execution layer clients in simulated networks. Following ones are supported:</p>
<ul>
<li><code>Geth</code></li>
<li><code>Nethermind</code></li>
<li><code>Besu</code></li>
<li><code>Erigon</code></li>
</ul>
<p>When it comes to consensus layer we currently support only <code>Prysm</code>.</p>
<p>The easiest way to start a simulated network is to use a builder. It allows to configure the network in a fluent way and then start it. For example:</p>
<pre><code class="language-go">builder := NewEthereumNetworkBuilder()
cfg, err: = builder.
    WithEthereumVersion(EthereumVersion_Eth2).
    WithExecutionLayer(ExecutionLayer_Geth).
    Build()
</code></pre>
<p>Since we support both <code>eth1</code> (aka pre-Merge) and <code>eth2</code> (aka post-Merge) client versions, you need to specify which one you want to use. You can do that by calling <code>WithEthereumVersion</code> method. There's no default provided. The only exception is when you use custom docker images (instead of default ones), because then we can determine which version it is based on the image version.</p>
<p>If you want your test to execute as fast as possible go for <code>eth1</code> since it's either using a fake PoW or PoA consensus and is much faster than <code>eth2</code> which uses PoS consensus (where there is a minimum viable length of slot/block, which is 4 seconds; for <code>eth1</code> it's 1 second). If you want to test the latest features, changes or forks in the Ethereum network and have your tests running on a network which is as close as possible to Ethereum Mainnet, go for <code>eth2</code>.</p>
<p>Every component has some default Docker image it uses, but builder has a method that allows to pass custom one:</p>
<pre><code class="language-go">builder := NewEthereumNetworkBuilder()
cfg, err: = builder.
    WithEthereumVersion(EthereumVersion_Eth2).
    WithConsensusLayer(ConsensusLayer_Prysm).
    WithExecutionLayer(ExecutionLayer_Geth).
    WithCustomDockerImages(map[ContainerType]string{
        ContainerType_Geth: "my-custom-geth-pos-image:my-version"}).
    Build()
</code></pre>
<p>When using a custom image you can even further simplify the builder by calling only <code>WithCustomDockerImages</code> method. Based on the image name and version we will determine which execution layer client it is and whether it's <code>eth1</code> or <code>eth2</code> client:</p>
<pre><code class="language-go">builder := NewEthereumNetworkBuilder()
cfg, err: = builder.
    WithCustomDockerImages(map[ContainerType]string{
        ContainerType_Geth: "ethereum/client-go:v1.13.10"}).
    Build()
</code></pre>
<p>In the case above we would launch a <code>Geth</code> client with <code>eth2</code> network and <code>Prysm</code> consensus layer.</p>
<p>You can also configure epochs at which hardforks will happen. Currently only <code>Deneb</code> is supported. Epoch must be &gt;= 1. Example:</p>
<pre><code class="language-go">builder := NewEthereumNetworkBuilder()
cfg, err: = builder.
    WithConsensusType(ConsensusType_PoS).
    WithConsensusLayer(ConsensusLayer_Prysm).
    WithExecutionLayer(ExecutionLayer_Geth).
    WithEthereumChainConfig(EthereumChainConfig{
        HardForkEpochs: map[string]int{"Deneb": 1},
    }).
    Build()
</code></pre>
<h2 id="command-line"><a class="header" href="#command-line">Command line</a></h2>
<p>You can start a simulated network with a single command:</p>
<pre><code class="language-sh">go run docker/test_env/cmd/main.go start-test-env private-chain
</code></pre>
<p>By default it will start a network with 1 node running <code>Geth</code> and <code>Prysm</code>. It will use default chain id of <code>1337</code> and won't wait for the chain to finalize at least one epoch. Once the chain is started it will save the network configuration in a <code>JSON</code> file, which then you can use in your tests to connect to that chain (and thus save time it takes to start a new chain each time you run your test).</p>
<p>Following cmd line flags are available:</p>
<pre><code class="language-sh">  -c, --chain-id int             chain id (default 1337)
  -l, --consensus-layer string   consensus layer (prysm) (default "prysm")
  -t, --consensus-type string    consensus type (pow or pos) (default "pos")
  -e, --execution-layer string   execution layer (geth, nethermind, besu or erigon) (default "geth")
  -w, --wait-for-finalization    wait for finalization of at least 1 epoch (might take up to 5 minutes)
      --consensus-client-image string   custom Docker image for consensus layer client
      --execution-layer-image string    custom Docker image for execution layer client
      --validator-image string          custom Docker image for validator
</code></pre>
<p>To connect to that environment in your tests use the following code:</p>
<pre><code class="language-go">	builder := NewEthereumNetworkBuilder()
	cfg, err := builder.
		WithExistingConfigFromEnvVar().
		Build()

    if err != nil {
        return err
    }

	net, rpc, err := cfg.Start()
    if err != nil {
        return err
    }
</code></pre>
<p>Builder will read the location of chain configuration from env var named <code>PRIVATE_ETHEREUM_NETWORK_CONFIG_PATH</code> (it will be printed in the console once the chain starts).</p>
<p><code>net</code> is an instance of <code>blockchain.EVMNetwork</code>, which contains characteristics of the network and can be used to connect to it using an EVM client. <code>rpc</code> variable contains arrays of public and private RPC endpoints, where "private" means URL that's accessible from the same Docker network as the chain is running in.</p>
<h2 id="logs"><a class="header" href="#logs">Logs</a></h2>
<p>By default, we will save logs of all Docker containers running on the host machine, when the test ends (regardless whether it failed or succeeded). They will be available in the <code>./logs/&lt;test-name&gt;&lt;date&gt;</code> directory. Same goes for dumping the databases of PostgresDBs
used by the Chainlink nodes. These will be saves in the <code>./db_dumps/&lt;test-name&gt;&lt;date&gt;</code> directory.</p>
<h2 id="loki-and-grafana"><a class="header" href="#loki-and-grafana">Loki and Grafana</a></h2>
<p>If you need to pass Loki or Grafana configuration to your tests you can do that by providing the following config:</p>
<pre><code class="language-toml">[Logging.Loki]
tenant_id="promtail"
url="https://change.me"
basic_auth_secret="my-secret-auth"
bearer_token_secret="bearer-token"
</code></pre>
<p>Also, do remember that different URL should be used when running in CI and everywhere else. In CI it should be a public endpoint, while in local environment it should be a private one.</p>
<p>If your test has a Grafana dashboard you should provide the following config:</p>
<pre><code class="language-toml">[Logging.Grafana]
base_url="https://your-grafana-url"
dashboard_url="/my-dashboard"
dashboard_uid="my-dashboard-uid" # optional
</code></pre>
<h2 id="grouping-test-execution"><a class="header" href="#grouping-test-execution">Grouping test execution</a></h2>
<p>When running tests in CI you're probably interested in grouping logs by test execution, so that you can easily find the logs in Loki. To do that your job should set <code>RUN_ID</code> environment variable. In GHA it's recommended to set it to workflow id. If that variable is not set, then a run id will be automatically generated and saved in <code>.run.id</code> file, so that it can be shared by tests that are part of the same execution, but are running in different processes.</p>
<h2 id="test-summary"><a class="header" href="#test-summary">Test Summary</a></h2>
<p>In order to facilitate displaying information in GH's step summary <code>testsummary</code> package was added. It exposes a single function <code>AddEntry(testName, key string, value interface{}) </code>. When you call it, it either creates a test summary JSON file or appends to it. The result is is a map of keys with values.</p>
<p>Example:</p>
<pre><code class="language-JSON">{
   "file":[
      {
         "test_name":"TestOCRv2Basic",
         "value":"./logs/TestOCRv2Basic-2023-12-01T18-00-59-TestOCRv2Basic-38ac1e52-d0a6-48"
      }
   ],
   "loki":[
      {
         "test_name":"TestOCRv2Basic",
         "value":"https://grafana.ops.prod.cldev.sh/d/ddf75041-1e39-42af-aa46-361fe4c36e9e/ci-e2e-tests-logs?orgId=1\u0026var-run_id=TestOCRv2Basic-38ac1e52-d0a6-48\u0026var-container_id=cl-node-a179ca7d\u0026var-container_id=cl-node-76798f87\u0026var-container_id=cl-node-9ff7c3ae\u0026var-container_id=cl-node-43409b09\u0026var-container_id=cl-node-3b6810bd\u0026var-container_id=cl-node-69fed256\u0026from=1701449851165\u0026to=1701450124925"
      }
   ]
}
</code></pre>
<p>In GHA after tests have ended we can use tools like <code>jq</code> to extract the information we need and display it in step summary.</p>
<h1 id="toml-config"><a class="header" href="#toml-config">TOML Config</a></h1>
<p>Basic and universal building blocks for TOML-based config are provided by <code>config</code> package. For more information do read <a href="lib/config/config.html">this</a>.</p>
<h1 id="ecr-mirror"><a class="header" href="#ecr-mirror">ECR Mirror</a></h1>
<p>An ecr mirror can be used to push images used often in order to bypass rate limit issues from dockerhub. The list of image mirrors can be found in the <a href="https://github.com/smartcontractkit/chainlink-testing-framework/blob/main/.github/workflows/update-internal-mirrors.yaml">matrix here</a>. This currently works with images with version numbers in dockerhub. Support for gcr is coming in the future. The images must also have a version number so putting <code>latest</code> will not work. We have a separate list for one offs we want that can be added to <a href="https://github.com/smartcontractkit/chainlink-testing-framework/blob/main/.github/actions/update-internal-mirrors/scripts/mirror.json">here</a> that does work with gcr and latest images. Note however for <code>latest</code> it will only pull it once and will not update it in our mirror if the latest on the public repository has changed, in this case it is preferable to update it manually when you know that you need the new latest and the update will not break your tests.</p>
<p>For images in the mirrors you can use the INTERNAL_DOCKER_REPO environment variable when running tests and it will use that mirror in place of the public repository.</p>
<p>We have two ways to add new images to the ecr. The first two requirements are that you create the ecr repository with the same name as the one in dockerhub out in aws and then add that ecr to the infra permissions (ask TT if you don't know how to do this).</p>
<ol>
<li>If it does not have version numbers or is gcr then you can add it <a href="https://github.com/smartcontractkit/chainlink-testing-framework/blob/main/.github/actions/update-internal-mirrors/scripts/mirror.json">here</a></li>
<li>You can add to the <a href="https://github.com/smartcontractkit/chainlink-testing-framework/blob/main/.github/actions/update-internal-mirrors/scripts/update_mirrors.sh">mirror matrix</a> the new image name and an expression to get the latest versions added when the workflow runs. You can check the postgres one used in there for an example but basically the expression should filter out only the latest image or 2 for that particular version when calling the dockerhub endpoint, example curl call <code>curl -s "https://hub.docker.com/v2/repositories/${image_name}/tags/?page_size=100" | jq -r '.results[].name' | grep -E ${image_expression}</code> where image_name could be <code>library/postgres</code> and image_expression could be <code>'^[0-9]+\.[0-9]+$'</code>. Adding your ecr to this matrix should make sure we always have the latest versions for that expression.</li>
</ol>
<h2 id="debugging-http-and-rpc-calls"><a class="header" href="#debugging-http-and-rpc-calls">Debugging HTTP and RPC calls</a></h2>
<pre><code class="language-bash">export SETH_LOG_LEVEL=info
export RESTY_DEBUG=true
</code></pre>
<h2 id="loki-client"><a class="header" href="#loki-client">Loki Client</a></h2>
<p>The <code>LokiClient</code> allows you to easily query Loki logs from your tests. It supports basic authentication, custom queries, and can be configured for (Resty) debug mode.</p>
<h3 id="debugging-resty-and-loki-client"><a class="header" href="#debugging-resty-and-loki-client">Debugging Resty and Loki Client</a></h3>
<pre><code class="language-bash">export LOKI_CLIENT_LOG_LEVEL=info
export RESTY_DEBUG=true
</code></pre>
<h3 id="example-usage"><a class="header" href="#example-usage">Example usage:</a></h3>
<pre><code class="language-go">auth := LokiBasicAuth{
    Username: os.Getenv("LOKI_LOGIN"),
    Password: os.Getenv("LOKI_PASSWORD"),
}

queryParams := LokiQueryParams{
		Query:     `{namespace="test"} |= "test"`,
		StartTime: time.Now().AddDate(0, 0, -1),
		EndTime:   time.Now(),
		Limit:     100,
	}

lokiClient := NewLokiClient("https://loki.api.url", "my-tenant", auth, queryParams)
logEntries, err := lokiClient.QueryLogs(context.Background())
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="legacy.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="lib/blockchain.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="legacy.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="lib/blockchain.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="mermaid.min.js"></script>
        <script src="mermaid-init.js"></script>


    </div>
    </body>
</html>
